openapi: 3.0.0
info:
  title: Simple dashboard for PostgreSQL
  version: 0.0.1
servers:
  - url: http://localhost:8001/api
tags:
  - name: cluster
    description: Everything related to Postgres cluster data
paths:
  /cluster/status:
    get:
      tags:
        - cluster
      summary: Get server current status
      operationId: GetStatus
      responses:
        200:
          description: Server current status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetStatusResponse"
              examples:
                success:
                  summary: Status received successfully
                  value:
                    postgres_connection: connected
                connection lost:
                  summary: Status with lost connection
                  value:
                    postgres_connection: disconnected
        400:
          description: Request server status failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBase"
  /cluster/connect:
    post:
      tags:
        - cluster
      summary: Connect to Postgres cluster
      description: Connect to Postgres cluster
      operationId: ClusterConnect
      requestBody:
        required: true
        description: Request's data payload
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ClusterConnectData"
      responses:
        200:
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetStatusResponse"
        422:
          description: Request data invalid
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RequestValidationError"
        400:
          description: Connection attempt failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBase"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBase"
  /cluster/disconnect:
    post:
      tags:
        - cluster
      summary: Disconnect from Postgres cluster
      description: Disconnect from Postgres cluster
      operationId: ClusterDisconnect
      responses:
        200:
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetStatusResponse"
        400:
          description: Disonnection attempt failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBase"
        default:
          description: Unexpected error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBase"
  /cluster/version:
    get:
      tags:
        - cluster
      summary: Get detailed Postgres version info
      description: Get detailed Postgres version info
      operationId: PostgresVersion
      responses:
        200:
          description: Successful operation
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetPostgresVersionResponse"
        400:
          description: Attempt failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorBase"
components:
  schemas:
    ErrorBase:
      type: object
      description: Error part that should be present in all errors
      required:
        - message
      properties:
        message:
          type: string
          example: something went wrong
    RequestValidationError:
      allOf:
        - $ref: "#/components/schemas/ErrorBase"
        - type: object
          properties:
            reason:
              type: string
              example: the body fields are invalid
          required:
            - reason
    ConnectionStatus:
      type: string
      enum: [connecting, connected, disconnected, error]
      x-enum-varnames:
        - PgConnectionStatusConnecting,
        - PgConnectionStatusConnected,
        - PgConnectionStatusDisconnected,
        - PgConnectionStatusError,
      description: PostgreSQL connection state
    GetStatusResponse:
      type: object
      required:
        - postgres_connection
      properties:
        postgres_connection:
          $ref: "#/components/schemas/ConnectionStatus"
          example: connected
          description: Represents connection state between dashboard and postgres
    ClusterConnectData: # internal/scopes/cluster/entities/entities.go
      x-go-type: clusterEntities.AuthData
      x-go-type-import:
        path: dashboard/api/internal/scopes/cluster/entities
        name: clusterEntities
      x-go-type-name: clusterEntities.AuthData
      type: object
      required:
        - host
        - port
        - user
        - password
        - sslmode
      properties:
        host:
          type: string
          example: 127.0.0.1
        port:
          type: integer
          example: 5432
        user:
          type: string
          example: postgres
        password:
          type: string
          example: postgres
        database:
          type: string
          example: postgres
        sslmode:
          type: string
          example: ""
    GetPostgresVersionResponse:
      x-go-type: clusterEntities.PostgresVersion
      x-go-type-import:
        path: dashboard/api/internal/scopes/cluster/entities
        name: clusterEntities
      x-go-type-name: clusterEntities.PostgresVersion
      type: object
      required:
        - version
        - compiler
        - bitDepth
      properties:
        version:
          type: string
          example: PostgreSQL 15.3 on x86_64-pc-linux-gnu
        compiler:
          type: string
          example: compiled by gcc (Ubuntu 11.3.0) 11.3.0
        bitDepth:
          type: string
          example: 64-bit
